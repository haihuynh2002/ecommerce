<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{common/base :: head}"></head>

<body>
    <div th:replace="~{common/base :: loader}"></div>
    <header th:replace="~{common/base :: header}"></header>
    
    <div class="container padding-medium">
        <div class="row flex-row-reverse g-md-5">
            <main class="col-md-12">
                <div class="row product-content product-store" id="product-content">

                   
                </div>
               
            </main>
        </div>
    </div>

    <footer th:replace="~{common/base :: footer}"></footer>
    <script>
        function addToCart(id) {
            let product = null;
            $.ajax({
                url: `/api/cart`,
                method: 'POST',
                contentType: "application/json",
                data: JSON.stringify({
                    productId: id,
                    quantity: 1
                }),
                success: function () {
                    toastr.success('Product added to cart', 'Success');
                    $.ajax({
                        url: '/api/cart',
                        method: 'GET',
                        success: function (items) {
                            $('#cart-content').html(items.map(item => `
                                    <li
                                    class="list-group-item bg-transparent d-flex justify-content-between lh-sm"
                                    >
                                    <div>
                                        <h5>
                                        <a href="index.html">${item.product.name}</a>
                                        </h5>
                                        <small>${item.product.brandName}</small>
                                    </div>
                                    <span class="text-primary">${item.product.price}</span>
                                    </li>
                                `).join(''));

                            $('.cart-size').html(`( ${items.length} )`);
                        }
                    })

                }
            });
        }

        function renderProduct(product) {
            return `
                    <div class="col-lg-3 col-md-4 mb-4">
                            <div class="card position-relative p-4 border rounded-3">
                                <img src="${product.imgUrl}" class="img-fluid shadow-sm" alt="product item">
                                <h6 class="mt-4 mb-0 fw-bold"><a href="/detail/${product.id}">${product.name}</a></h6>
                                <div class="review-content d-flex">
                                    <p class="my-2 me-2 fs-6 text-black-50">${product.brandName}</p>

                                    <div class="rating text-warning d-flex align-items-center">
                                        <svg class="star star-fill">
                                            <use xlink:href="#star-fill"></use>
                                        </svg>
                                        <svg class="star star-fill">
                                            <use xlink:href="#star-fill"></use>
                                        </svg>
                                        <svg class="star star-fill">
                                            <use xlink:href="#star-fill"></use>
                                        </svg>
                                        <svg class="star star-fill">
                                            <use xlink:href="#star-fill"></use>
                                        </svg>
                                        <svg class="star star-fill">
                                            <use xlink:href="#star-fill"></use>
                                        </svg>  
                                    </div>
                                </div>

                                <span class="price text-primary fw-bold mb-2 fs-5">$${product.price}</span>
                                <div class="card-concern position-absolute start-0 end-0 d-flex gap-2">
                                    <button type="button" class="btn btn-dark" data-bs-toggle="tooltip"
                                        data-bs-placement="top" data-bs-title="Tooltip on top" onclick="addToCart(${product.id})">
                                        <svg class="cart">
                                            <use xlink:href="#cart"></use>
                                        </svg>
                                    </button>
                                    <a href="#" class="btn btn-dark">
                                        <span>
                                            <svg class="wishlist">
                                                <use xlink:href="#heart"></use>
                                            </svg>
                                        </span>
                                    </a>
                                    
                                    
                                </div>
                            </div>
                        </div> 
                `;
        }

        $(document).ready(function () {
            let keywords = new URLSearchParams(window.location.search);
            console.log(keywords.get("keywords"));
            $.ajax({
                url: keywords.has("keywords")? '/api/product?keywords=' + keywords.get("keywords") :'/api/product',
                success: function (products) {
                    $('#product-content').html(products.map(renderProduct).join(''));
                }
            });

            

        });



      
    </script>
</body>

</html>