<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{common/base :: head}"></head>

<body>
    <div th:replace="~{common/base :: loader}"></div>
    <header th:replace="~{common/base :: header}"></header>

    <div class="shopify-grid padding-large">
        <div class="container">
            <div class="row flex-row-reverse g-md-5">
                <main class="col-md-9">
                    <div class="filter-shop d-flex flex-wrap justify-content-between mb-5">
                        <div class="showing-product">
                            <p>Showing 1â€“9 of 55 results</p>
                        </div>
                        <div class="sort-by">
                            <select id="sorting" class="form-select" data-filter-sort="" data-filter-order="">
                                <option value="">Default sorting</option>
                                <option value="">Name (A - Z)</option>
                                <option value="">Name (Z - A)</option>
                                <option value="">Price (Low-High)</option>
                                <option value="">Price (High-Low)</option>
                                <option value="">Rating (Highest)</option>
                                <option value="">Rating (Lowest)</option>
                                <option value="">Model (A - Z)</option>
                                <option value="">Model (Z - A)</option>
                            </select>
                        </div>
                    </div>
                    <div class="row product-content product-store" id="product-content">

                    </div>
                    <nav class="py-5" aria-label="Page navigation">
                        <ul class="pagination justify-content-center gap-4">
                            <li class="page-item disabled">
                                <a class="page-link">Prev</a>
                            </li>
                            <li class="page-item active" aria-current="page">
                                <span class="page-link">1</span>
                            </li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item">
                                <a class="page-link" href="#">Next</a>
                            </li>
                        </ul>
                    </nav>
                </main>
                <aside class="col-md-3">
                    <div class="sidebar ps-lg-5">
                        <div class="widget-menu">
                            <div class="widget-search-bar">
                                <form class="d-flex border rounded-3 p-2" role="search">
                                    <input class="form-control border-0 me-2 py-2" type="search" placeholder="Search"
                                        aria-label="Search">
                                    <button class="btn rounded-3 p-3 d-flex align-items-center" type="submit">
                                        <svg class="search text-light" width="18" height="18">
                                            <use xlink:href="#search"></use>
                                        </svg>
                                    </button>
                                </form>
                            </div>
                        </div>
                        <div class="widget-product-categories pt-5">
                            <div class="section-title overflow-hidden mb-2">
                                <h3 class="d-flex flex-column mb-0">Categories</h3>
                            </div>
                            <ul class="product-categories mb-0 sidebar-list list-unstyled">
                                <li class="cat-item">
                                    <a href="/collections/categories">All</a>
                                </li>
                                <li class="cat-item">
                                    <a href="#">Romance</a>
                                </li>
                                <li class="cat-item">
                                    <a href="#">Recipie</a>
                                </li>
                                <li class="cat-item">
                                    <a href="#">Sci-Fi</a>
                                </li>
                                <li class="cat-item">
                                    <a href="#">Lifestyle</a>
                                </li>
                            </ul>
                        </div>
                        <div class="widget-product-tags pt-5">
                            <div class="section-title overflow-hidden mb-2">
                                <h3 class="d-flex flex-column mb-0">Tags</h3>
                            </div>
                            <ul class="product-tags mb-0 sidebar-list list-unstyled">
                                <li class="tags-item">
                                    <a href="#">Sci-Fi</a>
                                </li>
                                <li class="tags-item">
                                    <a href="#">Revenge</a>
                                </li>
                                <li class="tags-item">
                                    <a href="#">Zombie</a>
                                </li>
                                <li class="tags-item">
                                    <a href="#">Vampire</a>
                                </li>
                            </ul>
                        </div>
                        <div class="widget-product-authur pt-5">
                            <div class="section-title overflow-hidden mb-2">
                                <h3 class="d-flex flex-column mb-0">authur</h3>
                            </div>
                            <ul class="product-tags mb-0 sidebar-list list-unstyled">
                                <li class="tags-item">
                                    <a href="#">Hanna Clark</a>
                                </li>
                                <li class="tags-item">
                                    <a href="#">Albert E. Beth</a>
                                </li>
                                <li class="tags-item">
                                    <a href="#">D.K John</a>
                                </li>
                            </ul>
                        </div>
                        <div class="widget-price-filter pt-5">
                            <div class="section-title overflow-hidden mb-2">
                                <h3 class="d-flex flex-column mb-0">Filter by price</h3>
                            </div>
                            <ul class="product-tags mb-0 sidebar-list list-unstyled">
                                <li class="tags-item">
                                    <a href="#">Less than $10</a>
                                </li>
                                <li class="tags-item">
                                    <a href="#">$10- $20</a>
                                </li>
                                <li class="tags-item">
                                    <a href="#">$20- $30</a>
                                </li>
                                <li class="tags-item">
                                    <a href="#">$30- $40</a>
                                </li>
                                <li class="tags-item">
                                    <a href="#">$40- $50</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </div>

    <footer th:replace="~{common/base :: footer}"></footer>
    <script>
        function addToCart(id) {
            let product = null;
            $.ajax({
                url: `/api/cart`,
                method: 'POST',
                contentType: "application/json",
                data: JSON.stringify({
                    productId: id,
                    quantity: 1
                }),
                success: function () {
                    $.ajax({
                        url: '/api/cart',
                        method: 'GET',
                        success: function (items) {
                            $('#cart-content').html(items.map(item => `
                                    <li
                                    class="list-group-item bg-transparent d-flex justify-content-between lh-sm"
                                    >
                                    <div>
                                        <h5>
                                        <a href="index.html">${item.product.name}</a>
                                        </h5>
                                        <small>${item.product.brandName}</small>
                                    </div>
                                    <span class="text-primary">${item.product.price}</span>
                                    </li>
                                `).join(''));

                            $('.cart-size').html(`( ${items.length} )`);
                        }
                    })

                }
            });
        }

        function renderProduct(product) {
            return `
                    <div class="col-lg-3 col-md-4 mb-4">
                            <div class="card position-relative p-4 border rounded-3">
                                <img src="images/product-item10.png" class="img-fluid shadow-sm" alt="product item">
                                <h6 class="mt-4 mb-0 fw-bold"><a href="single-product.html">${product.name}</a></h6>
                                <div class="review-content d-flex">
                                    <p class="my-2 me-2 fs-6 text-black-50">${product.brandName}</p>

                                    <div class="rating text-warning d-flex align-items-center">
                                        <svg class="star star-fill">
                                            <use xlink:href="#star-fill"></use>
                                        </svg>
                                        <svg class="star star-fill">
                                            <use xlink:href="#star-fill"></use>
                                        </svg>
                                        <svg class="star star-fill">
                                            <use xlink:href="#star-fill"></use>
                                        </svg>
                                        <svg class="star star-fill">
                                            <use xlink:href="#star-fill"></use>
                                        </svg>
                                        <svg class="star star-fill">
                                            <use xlink:href="#star-fill"></use>
                                        </svg>
                                    </div>
                                </div>

                                <span class="price text-primary fw-bold mb-2 fs-5">$${product.price}</span>
                                <div class="card-concern position-absolute start-0 end-0 d-flex gap-2">
                                    <button type="button" class="btn btn-dark" data-bs-toggle="tooltip"
                                        data-bs-placement="top" data-bs-title="Tooltip on top" onclick="addToCart(${product.id})">
                                        <svg class="cart">
                                            <use xlink:href="#cart"></use>
                                        </svg>
                                    </button>
                                    <a href="#" class="btn btn-dark">
                                        <span>
                                            <svg class="wishlist">
                                                <use xlink:href="#heart"></use>
                                            </svg>
                                        </span>
                                    </a>
                                </div>
                            </div>
                        </div> 
                `;
        }

        $(document).ready(function () {

            $.ajax({
                url: '/api/product',
                success: function (products) {
                    $('#product-content').html(products.map(renderProduct).join(''));
                }
            });
        });


    </script>
</body>

</html>